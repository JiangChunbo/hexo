---
title: PKI 笔记
date: 2022-10-02 23:21:58
tags:
- Cryptography
---


PKI Public Key Infrastructure

## 


## PKI 在管理加密密钥中的应用

对称加密和非对称加密都面临一个重大挑战: 你如何知道你收到的公钥实际上属于你认为它应该属于的人？

即使使用非对称加密，“中间人”的风险依然存在。例如，如果有人截获了 Bob 的公钥，制作了他自己的私钥，然后为 Alice 生成了一个新的公钥，该怎么办？在这种情况下，Alice 会为 Blob 加密i奥西，中间人可以解密消息，改变它们，然后重新加密，Alice 和 Blob 都不会知道。


PKI 通过颁发和管理拥有私钥和公钥的人、设备、应用程序的数字证书来解决这一问题。简而言之，PKI 为密钥分配身份，以便接收者能够准确地验证所有者。这种验证使用户有信心，如果他们发送一个加密的消息给那个人（或者设备），预期的接收者是一个实际会读取消息的人，而不是任何其他可能坐在“中间的人”。

> PKI 只是负责帮用户实现安全的公钥交换。至于用户具体要做什么，他并不关心。

## 数字证书在 PKI 的作用

PKI 通过颁发和管理数字证书来管理加密密钥。数字证书也被称为 X.509 证书和 PKI 证书。

不过，你可以参考这些，数字证书具备以下性质:

- 相当于驾驶执照或护照的电子产品
- 包含有关个人或实体的信息
- 由受信任的第三方发行
- 防篡改
- 包含可以证明其真实性的信息
- 可以追踪到发行人
- 具有过期日期
- 呈现给某人（某物）以供验证


## 引入证书颁发机构

证书颁发机构（CA）负责创建数字证书，并拥有用于审查收件人和颁发证书的政策、实践和程序。

具体而言，CA 的拥有者及营办商须决定: 

- 证书接收者的审查方法
- 颁发的证书类型
- 证书中包含的参数
- 安全和操作程序


<img src="https://www.keyfactor.com/wp-content/uploads/PKI-Certification-Authorities.png">

一旦 CA 做出这些决定，它们必须正式地记录它们的政策。从那里开始，由证书的使用者决定它们希望在来自给定 CA 的证书中放置多少信任。

## 证书的创建过程如何工作

证书的创建过程非常依赖非对称加密，其工作原理如下:

- 创建私钥，并计算相应的公钥
- CA 请求私钥所有者的任何标识属性，并审查该信息
- 公钥和标识属性被编码到证书签名请求（CSR）中
- 密钥所有者签署 CSR 以证明拥有该私钥
- 发出 CA 验证请求并使用 CA 自己的私钥签署证书


任何人都可以使用证书的公共部分，通过确认谁拥有用于签名证书的私钥，来验证证书实际上是由 CA 颁发的。并且，假设他们认为 CA 值得信任，他们可以验证他们发送给证书持有者的任何东西实际上都会发送给预期的接收者，并且使用该证书持有者的私钥签名的任何东西确实是有这个人/设备签名的。

这个过程中需要注意的一个重要部分就是，CA 本身有自己的私钥和相应的公钥，这就产生了对 CA 层次结构的需要。


## CA 层次结构和根 CA 如何创建信任层 

由于每个 CA 都有自己的证书，因此可以通过 CA 层次结构创建信任层 —— 在这种层次结构中，CA 为其他 CA 颁发证书。然而，这个过程不是循环的，因为最终会有一个根证书。通常，证书有一个发行者和一个主体作为两个独立方，但是对于根 CA，这两方是相同的，这意味着根 CA 是自签名的。因此，人们必须本能地信任根证书机构，相信任何可以最速到该机构的证书。

## 根 CA 安全性至关重要

所有的一切都使得私钥的安全性对 CA 来说额外重要。私钥落入坏人手中在任何情况下都是不好的，但是对于 CA 来说尤其是毁灭性的，因为这样就会有人以欺诈的方式颁发证书。


## 确定 PKI CA 层次结构中的最佳层级

至少两层层次结构是绝对必要的，因为根 CA 应该有 99.9% 的时间处于离线状态，这对于定期发布证书的下级 CA 来说是一个困难的标准，因为他们需要在线发布新的证书。




## 构建私有 CA


- 生成私钥

```bash
cd /etc/pki/CA
umask 077
openssl genrsa -out /etc/pki/CA/private/cakey.pem 4096
```


- 自签证书

```bash
openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3650
```


- 为 CA 提供所需的目录及文件

```bash
mkdir  -pv  /etc/pki/CA/{certs,crl,newcerts}
touch  /etc/pki/CA/{serial,index.txt}
echo  01 > /etc/pki/CA/serial
```