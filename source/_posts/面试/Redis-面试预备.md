---
title: Redis 面试预备
date: 2022-07-24 18:38:41
tags:
- Redis
---

# Redis 面试预备

## 为什么用 Redis

- 高并发
- 高可用


## 缓存


### 缓存穿透

大量请求的 key 不存在于缓存，导致请求直接落到数据库

解决方法:

- 对参数进行校验。比如 id 不能小于 0、特定数据的格式，如果不满足，则直接返回错误消息给客户端。

- 通过布隆过滤器判断 key 是否不存在。如果 key 不存在，直接返回给客户端。如果 key 可能存在，则走缓存或查询数据库。

- 将无效的 key 也缓存下来。如果受到恶意攻击，每次构建不同的请求 key，会导致 redis 缓存大量无效的 key。尽量将无效的 key 过期时间设置短一些。


### 缓存雪崩

缓存在同一时间大面积失效，大量请求落到数据库，甚至引起数据库宕机。

例如，缓存模块产生问题（如：宕机等）。

解决方法：

- 使用 Redis 集群，增加可用性。

- 限流

热点数据在某一时刻大面积失效。

比如，用户晚上活动少，热点数据缓存在夜间过期。第二天早上集中某个时刻活跃。

解决方法:

- 缓存设置时间随机、更长甚至永不失效



### 缓存和数据库一致性





## 使用场景

1. 缓存


2. 记录用户在线人数


使用 zSet 结构


用户每次调用接口，在鉴权的时候刷新一次该用户 user_id 对应的 score


定时脚本，删除过期的数据:

```php
$redis->zRemRangeByScore(REDIS_ONLINE_USER, 0, time() - 5200);
```