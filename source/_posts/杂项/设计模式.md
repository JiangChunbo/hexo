---
title: 设计模式
date: 2022-07-16 16:01:03
tags:
- 设计模式
---
# 设计模式

## Proxy 模式

### Proxy 模式中的角色

在 Proxy 模式中一般有以下角色：

- Subject（主体）

Subject 定义了使 Proxy 和 RealSubject 之间具有一致性的接口。

- Proxy（代理人）

Proxy 会尽量处理来自外界的请求。当自己不能处理时，才会将工作交给 RealSubject。Proxy 也要实现 Subject 定义的接口。

- RealSubject（实际主体）

RealSubject 会在 Proxy 无法胜任工作时出场。它也会实现 Subject 接口。


下面这段示例程序实现了一个 "带有名字的打印机"

```java
public interface Printable {
    void setPrinterName(String name);

    String getPrinterName();

    void print(String string);
}
```

```java
public class Printer implements Printable {
    private String name;

    public Printer(String name) {
        this.name = name;
        heavyJob("正在生成 Printer 示例 (" + name + ")");
    }

    @Override
    public void setPrinterName(String name) {
        this.name = name;
    }

    @Override
    public String getPrinterName() {
        return this.name;
    }

    @Override
    public void print(String string) {
        System.out.println("===" + this.name + "===");
        System.out.println(string);
    }

    private void heavyJob(String msg) {
        System.out.println(msg);
        for (int i = 0; i < 5; i++) {
            try {
                TimeUnit.SECONDS.sleep(1);
            } catch (InterruptedException e) {
            }
            System.out.print(".");
        }
        System.out.println("结束。");
    }
}
```

```java
public class PrinterProxy implements Printable {
    private String name;
    private volatile Printer real;

    public PrinterProxy() {
    }

    public PrinterProxy(String name) {
        this.name = name;
    }

    @Override
    public void setPrinterName(String name) {
        if (this.real != null) {
            this.real.setPrinterName(name);
        }
        this.name = name;
    }

    @Override
    public String getPrinterName() {
        return this.name;
    }

    @Override
    public void print(String string) {
        this.ensure();
        real.print(string);
    }

    private void ensure() {
        if (this.real == null) {
            synchronized (this) {
                if (this.real == null) {
                    this.real = new Printer(this.name);
                }
            }
        }
    }
}
```

### Proxy 模式变体

- Virtual Proxy（虚拟代理）
  Virtual Proxy 就是上面呈现的 Proxy 模式。当真正需要 RealSubject 时，才生成和初始化实例。

- Remote Proxy（远程代理）
  Remote Proxy 可以让我们不必在意 RealSubject 是否在远程网络上，透明地使用它的功能。Java 的 RMI（Remote Method Invocation：远程方法调用）就相当于 Remote Proxy。

- Access Proxy
  Access Proxy 用于限制 RealSubject 的功能访问。例如，这种代理只允许访问特定的方法，当访问其他方法时则报错。


