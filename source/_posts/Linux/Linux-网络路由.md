---
title: Linux 网络路由
date: 2022-10-04 18:28:41
tags:
---

# Linux 路由
Linux 上分为三种路由:

- 主机路由，直接指名到某台具体的主机怎么走，主机路由也叫静态路由
- 网络路由，指明某类网络怎么走
- 默认路由，不走主机路由和网络路由的就走默认路由。操作系统上设置的默认路由一般也称为网关

多条路由的匹配规则。在 Linux 中，路由条目的优先级确定方式是先匹配掩码长度，再比较路由开销（metric）。也就是说，掩码位长的路由条路优先级一定比掩码位短的优先级高，所以主机路由的优先级最高，然后是直连网络（同网段）的路由，然后是网络路由，最后是默认路由。若路由条目的掩码长度相同，则比较节点之间的管理距离，管理距离短的生效。



例如下面的路由表，若 `ping 192.168.5.20`，先比对 `192.168.100.78`，无法匹配，然后比对网络路由，发现 `192.168.0.0` 匹配成功，所以选择该路由。


```c
[root@xuexi ~]# route -n
Kernel IP routing table
Destination Gateway Genmask Flags Metric Ref Use Iface
0.0.0.0 192.168.100.2 0.0.0.0         UG    100 0 0 eth0
172.16.10.0 0.0.0.0 255.255.255.0   U     100 0 0 eth1
192.168.0.0 192.168.100.70 255.255.0.0     UG    0 0 0 eth0
192.168.100.0 0.0.0.0 255.255.255.0   U     100 0 0 eth0
192.168.100.78 0.0.0.0 255.255.255.255 UH    0 0 0 eth0
```


由于两块网卡 eth0 和 eth1 都是 192.168.100.0/24 网段地址，所以它们的路由条目在掩码长度的匹配上是相同的，但是与 eth0 直连的网段主机通信时，肯定会选择 eth0 这条路由，因为 eth1 与该网段主机距离增加了 1。

```bash
[root@xuexi ~]# route -n
Kernel IP routing table
Destination Gateway Genmask Flags Metric Ref Use Iface
0.0.0.0 192.168.100.2 0.0.0.0         UG    100 0 0 eth0
192.168.100.0 0.0.0.0 255.255.255.0   U     100 0 0 eth0
192.168.100.0 0.0.0.0 255.255.255.0   U     101 0 0 eth1
```

所有网络设备，无论它们是主机，路由器，还是其他类型的网络节点（例如网络连接的打印机），都需要决定将 TCP/IP 数据包路由到何处。


router -n 命令列出路由表；-n 表示仅将结果显示为 IP 地址，并且不尝试执行 DNS 查找，该 DNS 查找将使用主机名 IP（如果可用）

```bash
[root@localhost ~]# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.0.3.2        0.0.0.0         UG    101    0        0 enp0s8
10.0.3.0        0.0.0.0         255.255.255.0   U     101    0        0 enp0s8
192.168.59.0    0.0.0.0         255.255.255.0   U     102    0        0 enp0s3
192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0
```

使用 -n 选型时，默认网关始终与 0.0.0.0 一起显示。默认网关的网络掩码为 0.0.0.0 意味着，无论网络类别如何，路由表中未通过附加目寻址到恩地网络或另一个出战路由器的任何数据包都将发送到默认网关。


# route 命令

对于Flags列，如果没有安装路由软件，则只可能出现下面的3种值：
U (route is up)
H (target is a host)
G (use gateway，也即是设置了下一跳的路由条目)
